% Last modified 2018-06-28
% Dorai Sitaram

\let\maybeendinput\relax
\ifx\shipout\UnDeFiNeD
  \let\maybeendinput\endinput
\else\edef\fmtnameQplain{plain}%
  \ifx\fmtname\fmtnameQplain\else
    \let\maybeendinput\endinput
  \fi
\fi\maybeendinput

% Load color.sty, which defines rgb, cmyk, gray.
% It also defines hsb, but not for LuaTeX.

\ifx\definecolor\UnDeFiNeD
  \ifx\miniltx\UnDeFiNeD
    \input miniltx
  \fi
  \input color.sty
\fi

\let\colorQorig\color

\let\definecolorQorig\definecolor

\def\color{\futurelet\colorQi\colorQii}

\def\colorQii{\ifx\colorQi[\let\colorQiii\colorQwithmodel
\else\let\colorQiii\colorQorig\fi\colorQiii}

\ifx\directlua\UnDeFiNeD
  \input colorxe
\else
  \input colorlua
\fi
