% t2pslides.tex
% Last modified 2009-04-25

\ifx\shipout\UnDeFiNeD\else\endinput\fi

\cssblock
.title {
  font-size: 1.5em;
  font-weight: inherit;
  text-align: left;
  margin-top: .5em;
}

.beginsection {
  font-size: 1.5em;
}

.navigation {
  display: none;
}

.colophon {
  font-size: 50%;
}

.colophon .advertisement {
  display: none;
}

tt i {
  font-family: inherit;
}

.verbatim em {
  font-family: inherit;
}

.scheme em {
  font-family: inherit;
}

body {
  background: white;
  font-size: 22;
  font-weight: bold;
  font-family: Verdana, Arial, Lucida;
}

div#slidetitle {
  margin-top: 150px;
  margin-left: 100px;
  margin-right: 100px;
}

div#slidecontent {
  margin-top: 10px;
  margin-left: 75px;
  margin-right: 75px;
}

div#slideother {
  position: absolute;
  top: 0px;
  left: 0px;
  height: 100%;
  width: 100%;
  background-color: transparent;
  z-index: 1;
}

h1 {
  color: darkblue;
  font-size: 1.5em;
  padding-bottom: 20px;
  border-bottom: thick solid blue;
}

div > ul {
  margin-left: -1em;
}

\endcssblock

% in case included graphics set width based on \hsize, \textwidth -- let's
% make these dimens reflect typical monitor width

\hsize 11in
\ifx\textwidth\UnDeFiNeD\else
\textwidth 11in
\fi

%

\ifx\TZPcommonlisp 1
\evalq{
(defvar *js-port* nil)
(let* ((js-file0 (concatenate 'string *jobname* "-Z-J.js"))
       (js-file (concatenate 'string *aux-dir/* js-file0)))
  ;
  (unless (>= *last-page-number* 0)
    (setq *afterbye*
          (nconc *afterbye*
                 (list (lambda ()
                         (write-log :separation-newline)
                         (write-log "Slideshow setup not finished")
                         (write-log :separation-newline))))))
  ;
  (write-aux `(!html-head
               ,(concatenate 'string
                 "<script language=\"javascript\" src=\""
                 js-file0 "\"></script>")))
  (write-aux `(!doctype none))
  ;
  (ensure-file-deleted js-file)
  (setq *js-port* (open js-file :direction :output :if-exists :supersede))
  (let ((o *js-port*))
    (princ "var toc = new Array(" o)
    (dotimes (i (1+ *last-page-number*))
        (unless (= i 0) (princ #\, o))
        (terpri o)
        (princ "     " o)
        (princ #\' o)
        (princ *jobname* o)
        (unless (= i 0)
          (princ *html-page-suffix* o)
          (princ i o))
        (princ *output-extension* o)
        (princ #\' o))
    (terpri o)
    (princ ");" o)
    (terpri o)))
}
\else
\evalq{
(define *js-port* #f)
(let* ((js-file0 (string-append *jobname* "-Z-J.js"))
       (js-file (string-append *aux-dir/* js-file0)))
  ;
  (unless (>= *last-page-number* 0)
    (set! *afterbye*
          (nconc *afterbye*
                 (list (lambda ()
                         (write-log ':separation-newline)
                         (write-log "Slideshow setup not finished")
                         (write-log ':separation-newline))))))
  ;
  (write-aux `(!html-head
               ,(string-append
                 "<script language=\"javascript\" src=\""
                 js-file0 "\"></script>")))
  (write-aux `(!doctype none))
  ;
  (ensure-file-deleted js-file)
  (set! *js-port* (open-output-file js-file))
  (let ((o *js-port*))
    (display "var toc = new Array(" o)
    (let loop ((i 0))
      (unless (> i *last-page-number*)
        (unless (= i 0) (display #\, o))
        (newline o)
        (display "     " o)
        (display #\' o)
        (display *jobname* o)
        (unless (= i 0)
          (display *html-page-suffix* o)
          (display i o))
        (display *output-extension* o)
        (display #\' o)
        (loop (+ i 1))))
    (newline o)
    (display ");" o)
    (newline o)))
}
\fi
\evalq{(dump-groupoid *js-port*)}
@
/*
% following from mozpoint.js, by Gagan Saksena, from
% http://mozpoint.mozdev.org.  Added some
% code to recognize mouse clicks.
*/

var keyTimeOut = 500;
var keyStack = new Array();
var ie = document.all ? true: false;

function currentFile() {
  k = String(document.location).split('/');
  return k[k.length-1];
}

function currentFileIndex() {
  f = currentFile();
  for (i=0; i<toc.length; ++i) {
    if (toc[i] == f)
      return i;
  }
  return -1;
}

function loadslide(c) {
  if (c>=0 && c <toc.length) {
    document.location = toc[c];
  }
}

function loadSlideFromKeys() {
  if (keyStack.length == 0) return;
  c = 0;
  i = 0;
  do {
    d = keyStack.pop();
    c += Math.pow(10, i++)*d;
  } while (keyStack.length);
  loadslide(parseInt(c));
}

function fireload(count) {
  if (count != keyStack.length) return;
  loadSlideFromKeys();
}

function loadotherstuff() {
  if (ie) {
    document.write('<DIV ID=slideother></DIV>');
    return;
  }

  var other = document.createElement("div");
  other.setAttribute("id", "slideother");

  document.firstChild.appendChild(other);
}

function toggle_blank(black) {
  var other = ie ?  document.all["slideother"] : document.getElementById("slideother");
  var color = black ?  "black" : "white";
  other.style.backgroundColor = (other.style.backgroundColor == color) ?
  "transparent" : color;
}

function keyEvents(e) {
  switch (e.which) {
    case 48: // 0
    case 49: // 1
    case 50: // 2
    case 51: // 3
    case 52: // 4
    case 53: // 5
    case 54: // 6
    case 55: // 7
    case 56: // 8
    case 57: // 9
      setTimeout(fireload, keyTimeOut, keyStack.push(e.which-48));
      break;
    case 66: // b
    case 87: // w
      toggle_blank(e.which == 66);
      break;
    case 32: // spacebar
    case 39: // rightkey
    case 40: // downkey
    case 78: // n
      loadslide(currentFileIndex()+1);
      break;
    case 37: // leftkey
    case 38: // upkey
    case 80: // p
      loadslide(currentFileIndex()-1);
      break;
    case 84: // t
      loadslide(0);
      break;
    default:
      break;
  }
}

function keyEventsIE() {
  e = event;
  e.which = e.keyCode;
  keyEvents(e);
}

function mouseEvents(e) {
  switch (e.which) {
    case 2:  if (ie)  loadslide(currentFileIndex() - 1); break;
    case 3:  if (!ie) loadslide(currentFileIndex() - 1); break;
    default: loadslide(currentFileIndex() + 1); break;
  }
  return false;
}

function mouseEventsIE() {
  e = event;
  e.which = e.button;
  mouseEvents(e);
}

function init_all() {
  document.onkeyup = ie ? keyEventsIE : keyEvents;
  document.onclick = ie ? mouseEventsIE : mouseEvents;
}

loadotherstuff();
window.onload = init_all;
@
\ifx\TZPcommonlisp 1
\evalq{
(terpri *js-port*)
(close *js-port*)
}
\else
\evalq{
(newline *js-port*)
(close-output-port *js-port*)
}
\fi
